# Membangun Model - Diabetes Prediction

## ğŸ“ Deskripsi Folder
Folder ini berisi implementasi model Machine Learning untuk prediksi diabetes menggunakan LightGBM dengan tracking menggunakan MLflow dan DagsHub.

## ğŸ“‚ Struktur Folder
```
Membangun_model/
â”œâ”€â”€ diabetes_preprocessing/              # Data hasil preprocessing
â”‚   â”œâ”€â”€ X_train.csv
â”‚   â”œâ”€â”€ X_test.csv
â”‚   â”œâ”€â”€ y_train.csv
â”‚   â”œâ”€â”€ y_test.csv
â”‚   â””â”€â”€ diabetes_preprocessed.csv
â”œâ”€â”€ modelling.py                         # Baseline model dengan MLflow autolog
â”œâ”€â”€ modelling_tuning.py                  # Advanced: Hyperparameter tuning
â”œâ”€â”€ requirements.txt                     # Dependencies
â”œâ”€â”€ DagsHub.txt                          # Link ke DagsHub repository
â”œâ”€â”€ screenshot_artifak_dagshub.png       # Screenshot artifacts di DagsHub
â””â”€â”€ Artifacts (generated by MLflow):
    â”œâ”€â”€ classification_report.txt
    â”œâ”€â”€ confusion_matrix.png
    â”œâ”€â”€ confusion_matrix.txt
    â”œâ”€â”€ cv_results_summary.txt
    â”œâ”€â”€ feature_importance_gain.json
    â”œâ”€â”€ feature_importance_gain.png
    â”œâ”€â”€ feature_importance_split.json
    â””â”€â”€ feature_importance_split.png
```

## ğŸ¤– Model & Algoritma
**Algorithm**: LightGBM Classifier
- Efisien untuk dataset tabular
- Handle class imbalance dengan SMOTE
- Support hyperparameter tuning

## ğŸ“Š Dua Pendekatan Modelling

### 1. **modelling.py** - Baseline Model
Pendekatan baseline dengan MLflow autolog untuk tracking otomatis.

**Features:**
- âœ… MLflow autolog enabled
- âœ… Tracking ke DagsHub
- âœ… Hyperparameters pre-configured
- âœ… Automatic logging (params, metrics, model)
- âœ… SMOTE untuk class imbalance

**Hyperparameters (Baseline):**
```python
n_estimators=500
max_depth=8
learning_rate=0.05
num_leaves=20
min_child_samples=15
subsample=0.85
colsample_bytree=0.95
reg_alpha=0.15
reg_lambda=0.1
```

**Model Performance (Baseline):**
| Metric | Value |
|--------|-------|
| **Accuracy** | **0.7403** (74.03%) |
| Precision | 0.6207 |
| Recall | 0.6667 |
| F1-Score | 0.6429 |
| AUC-ROC | 0.8113 |

**Cara Menjalankan:**
```bash
python modelling.py
```

---

### 2. **modelling_tuning.py** - Advanced Model (Tuned)
Pendekatan advanced dengan hyperparameter tuning menggunakan GridSearchCV.

**Features:**
- âœ… GridSearchCV untuk hyperparameter tuning
- âœ… StratifiedKFold (5-fold cross-validation)
- âœ… Manual MLflow logging
- âœ… 8 artifacts logged (beyond autolog)
- âœ… Extended metrics (MCC, Cohen's Kappa, Specificity)
- âœ… Tracking ke DagsHub

**Parameter Grid:**
```python
'n_estimators': [40, 50, 60]
'max_depth': [2, 3]
'learning_rate': [0.12, 0.15, 0.18]
'num_leaves': [10, 15, 20]
'min_child_samples': [25, 30, 35]
'subsample': [0.95, 1.0]
'colsample_bytree': [0.95, 1.0]
'reg_alpha': [0, 0.01]
'reg_lambda': [0, 0.01]
```

**Metrics Logged:**
- Standard: Accuracy, Precision, Recall, F1-Score, AUC-ROC
- Extended: Specificity, MCC, Cohen's Kappa
- CV: Best CV ROC-AUC Score

**Model Performance (Tuned):**
| Metric | Value | Improvement |
|--------|-------|-------------|
| **Accuracy** | **0.7662** (76.62%) | â¬†ï¸ +2.59% |
| Precision | 0.6324 | â¬†ï¸ +1.17% |
| Recall | 0.7963 | â¬†ï¸ +12.96% |
| F1-Score | 0.7049 | â¬†ï¸ +6.20% |
| AUC-ROC | 0.8304 | â¬†ï¸ +1.91% |
| **Specificity** | **0.75** | - |
| **MCC** | **0.5249** | - |
| **Cohen's Kappa** | **0.5156** | - |
| **Best CV ROC-AUC** | **0.8670** | - |

> âœ… **Tuned model menunjukkan peningkatan signifikan**, terutama pada **Recall** (+12.96%) yang penting untuk deteksi diabetes.

**Artifacts Generated (8 files):**
1. `confusion_matrix.png` - Visual confusion matrix
2. `confusion_matrix.txt` - Text confusion matrix
3. `classification_report.txt` - Detailed classification report
4. `feature_importance_gain.json` - Feature importance (gain) data
5. `feature_importance_gain.png` - Feature importance (gain) plot
6. `feature_importance_split.json` - Feature importance (split) data
7. `feature_importance_split.png` - Feature importance (split) plot
8. `cv_results_summary.txt` - CV and test results summary

**Cara Menjalankan:**
```bash
python modelling_tuning.py
```

## ğŸ”— MLflow Tracking - DagsHub Integration

**Repository**: https://dagshub.com/anggapradanaa/Membangun_model.mlflow

Kedua script terintegrasi dengan DagsHub untuk:
- Experiment tracking
- Model versioning
- Artifact storage
- Metrics visualization
- Model registry

## ğŸ“ˆ Evaluasi Model

**Confusion Matrix Components:**
- TN (True Negative): Correctly predicted No Diabetes
- TP (True Positive): Correctly predicted Diabetes
- FP (False Positive): Incorrectly predicted Diabetes
- FN (False Negative): Incorrectly predicted No Diabetes

**Additional Metrics:**
- **Specificity**: TN / (TN + FP) - True negative rate
- **MCC**: Matthews Correlation Coefficient (-1 to +1)
- **Cohen's Kappa**: Agreement measure between predictions

## ğŸ”§ Requirements

```
pandas
numpy
scikit-learn
imbalanced-learn
lightgbm
mlflow
dagshub
matplotlib
seaborn
```

Install dependencies:
```bash
pip install -r requirements.txt
```

## ğŸ“ Workflow

1. **Load Data** â†’ Load preprocessed data dari folder diabetes_preprocessing
2. **Train Model** â†’ Training dengan LightGBM
3. **Tuning (optional)** â†’ GridSearchCV untuk best hyperparameters
4. **Evaluate** â†’ Calculate metrics dan confusion matrix
5. **Log to MLflow** â†’ Track experiments ke DagsHub
6. **Save Artifacts** â†’ Generate visualizations dan reports

## ğŸ¯ Output

**Model Performance (Tuned):**
- Hasil tuning tersimpan di DagsHub MLflow
- Best parameters otomatis terseleksi
- Model terbaik tersimpan dengan metrics lengkap

**Artifacts:**
- Screenshots dashboard DagsHub
- Confusion matrix (PNG & TXT)
- Feature importance plots
- Classification reports
- CV results summary

## ğŸ“Š Monitoring

Semua experiments dapat dimonitor melalui:
- **DagsHub MLflow UI**: Metrics, parameters, artifacts
- **DagsHub Repository**: Code versioning, data tracking

---

**Author**: Angga Yulian Adi Pradana  
**Algorithm**: LightGBM Classifier  
**Tracking**: MLflow + DagsHub
